{% comment %}
  Modern Product Section
  Styled to match product-hero.liquid but uses actual product data
{% endcomment %}

<div class="product-hero" style="
  --section-padding-top: {{ section.settings.padding_top | default: 2 }}rem;
  --section-padding-bottom: {{ section.settings.padding_bottom | default: 2 }}rem;
  --section-padding-top-mobile: {{ section.settings.padding_top | default: 2 | times: 0.7 }}rem;
  --section-padding-bottom-mobile: {{ section.settings.padding_bottom | default: 2 | times: 0.7 }}rem;
  --section-padding-top-small: {{ section.settings.padding_top | default: 2 | times: 0.5 }}rem;
  --section-padding-bottom-small: {{ section.settings.padding_bottom | default: 2 | times: 0.5 }}rem;
" {{ section.shopify_attributes }}>
  <div class="product-hero__container">
    <div class="product-hero__content {% if section.settings.gallery_position == 'left' %}product-hero__content--gallery-left{% endif %}">
      
      <!-- Product Information -->
      <div class="product-hero__info">
        {% if section.settings.show_rating %}
          <div class="product-hero__rating">
            <div class="product-hero__stars">
              {% for i in (1..5) %}
                <span class="product-hero__star">★</span>
              {% endfor %}
            </div>
            <span class="product-hero__rating-text">{{ section.settings.rating_value | default: '4.7' }}</span>
            <span class="product-hero__reviews">{{ section.settings.reviews_text | default: '1000+ Verified Reviews' }}</span>
          </div>
        {% endif %}

        <h1 class="product-hero__headline">{{ product.title }}</h1>

        {% if product.description != blank %}
          <p class="product-hero__subheadline">{{ product.description | strip_html }}</p>
        {% endif %}

        {% if section.settings.show_features %}
          <ul class="product-hero__features">
            {% if section.settings.feature_1 != blank %}
              <li class="product-hero__feature">
                <span class="product-hero__feature-icon">✓</span>
                {{ section.settings.feature_1 }}
              </li>
            {% endif %}
            {% if section.settings.feature_2 != blank %}
              <li class="product-hero__feature">
                <span class="product-hero__feature-icon">✓</span>
                {{ section.settings.feature_2 }}
              </li>
            {% endif %}
            {% if section.settings.feature_3 != blank %}
              <li class="product-hero__feature">
                <span class="product-hero__feature-icon">✓</span>
                {{ section.settings.feature_3 }}
              </li>
            {% endif %}
            {% if section.settings.feature_4 != blank %}
              <li class="product-hero__feature">
                <span class="product-hero__feature-icon">✓</span>
                {{ section.settings.feature_4 }}
              </li>
            {% endif %}
          </ul>
        {% endif %}

        {% if section.settings.show_customer_satisfaction %}
          <div class="product-hero__satisfaction">
            {% if section.settings.show_avatars %}
              <div class="product-hero__avatars">
                {% if section.settings.avatar_1 != blank %}
                  {% assign avatar_alt = 'Customer photo' %}
                  {{ section.settings.avatar_1 | image_url: width: 80, height: 80 | image_tag: alt: avatar_alt, class: 'product-hero__avatar', loading: 'lazy' }}
                {% endif %}
                {% if section.settings.avatar_2 != blank %}
                  {% assign avatar_alt = 'Customer photo' %}
                  {{ section.settings.avatar_2 | image_url: width: 80, height: 80 | image_tag: alt: avatar_alt, class: 'product-hero__avatar', loading: 'lazy' }}
                {% endif %}
                {% if section.settings.avatar_3 != blank %}
                  {% assign avatar_alt = 'Customer photo' %}
                  {{ section.settings.avatar_3 | image_url: width: 80, height: 80 | image_tag: alt: avatar_alt, class: 'product-hero__avatar', loading: 'lazy' }}
                {% endif %}
                {% if section.settings.avatar_4 != blank %}
                  {% assign avatar_alt = 'Customer photo' %}
                  {{ section.settings.avatar_4 | image_url: width: 80, height: 80 | image_tag: alt: avatar_alt, class: 'product-hero__avatar', loading: 'lazy' }}
                {% endif %}
              </div>
            {% endif %}
            <span class="product-hero__customers">{{ section.settings.customers_text | default: '8K+ Happy Customers' }}</span>
            <span class="product-hero__stock-indicator">● </span>
            <span class="product-hero__stock">{{ section.settings.stock_text | default: 'In stock and ready to ship' }}</span>
          </div>
        {% endif %}

        <!-- Product Form -->
        {% if section.settings.show_product_form %}
          <div class="product-hero__form">
            {% form 'product', product, class: 'product-form' %}
              {% assign current_variant = product.selected_or_first_available_variant %}
              
              <!-- Price Display -->
              <div class="product-hero__price">
                {% if current_variant.compare_at_price > current_variant.price %}
                  <span class="product-hero__price-compare">{{ current_variant.compare_at_price | money }}</span>
                  <span class="product-hero__price-current">{{ current_variant.price | money }}</span>
                  <span class="product-hero__price-discount">
                    {% assign discount = current_variant.compare_at_price | minus: current_variant.price %}
                    {% assign discount_percent = discount | times: 100 | divided_by: current_variant.compare_at_price | round %}
                    -{{ discount_percent }}%
                  </span>
                {% else %}
                  <span class="product-hero__price-current">{{ current_variant.price | money }}</span>
                {% endif %}
              </div>

              <!-- Variant Selection -->
              {% if product.variants.size > 1 %}
                <div class="product-hero__variants">
                  <label for="variant-select">{{ 'products.variant_select' | t | default: 'Variant' }}:</label>
                  <select name="id" id="variant-select" class="product-hero__variant-select">
                    {% for variant in product.variants %}
                      <option
                        value="{{ variant.id }}"
                        {% if variant == current_variant %}selected="selected"{% endif %}
                        {% unless variant.available %}disabled="disabled"{% endunless %}
                        data-price="{{ variant.price | money }}"
                        data-compare-price="{{ variant.compare_at_price | money }}"
                      >
                        {{ variant.title }}{% unless variant.available %} - {{ 'products.sold_out' | t | default: 'Sold out' }}{% endunless %}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              {% else %}
                <input type="hidden" name="id" value="{{ current_variant.id }}">
              {% endif %}

              <!-- Quantity and Add to Cart -->
              <div class="product-hero__purchase">
                {% if section.settings.show_quantity %}
                  <div class="product-hero__quantity">
                    <label for="quantity">{{ 'products.quantity' | t | default: 'Quantity' }}:</label>
                    <input type="number" name="quantity" id="quantity" min="1" value="1" class="product-hero__quantity-input">
                  </div>
                {% else %}
                  <input type="hidden" name="quantity" value="1">
                {% endif %}
                
                {% if section.settings.show_add_to_cart %}
                  <button type="submit" class="product-hero__cta" {% unless current_variant.available %}disabled{% endunless %}>
                    {% if current_variant.available %}
                      {{ 'products.add_to_cart' | t | default: 'Add to cart' }}
                    {% else %}
                      {{ 'products.sold_out' | t | default: 'Sold out' }}
                    {% endif %}
                  </button>
                {% endif %}
              </div>

              <!-- Payment Buttons -->
              {% if section.settings.show_payment_buttons %}
                <div class="product-hero__payment-buttons">
                  {{ form | payment_button }}
                </div>
              {% endif %}
            {% endform %}
          </div>
        {% endif %}

        {% if section.settings.show_guarantees %}
          <div class="product-hero__guarantees">
            {% for i in (1..4) %}
              {% assign guarantee_icon = 'guarantee_icon_' | append: i %}
              {% assign guarantee_text = 'guarantee_text_' | append: i %}
              {% if section.settings[guarantee_text] != blank %}
                <div class="product-hero__guarantee">
                  <div class="product-hero__guarantee-icon">
                    {% if section.settings[guarantee_icon] != blank %}
                      {{ section.settings[guarantee_icon] }}
                    {% else %}
                      <span class="product-hero__guarantee-placeholder"></span>
                    {% endif %}
                  </div>
                  <span class="product-hero__guarantee-text">{{ section.settings[guarantee_text] }}</span>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Gallery -->
      <div class="product-hero__gallery">
        <!-- Debug: Product has {{ product.images.size }} images -->
        {% if product.images.size > 0 %}
          <!-- Main Carousel - Following Splide Tutorial -->
          <section id="main-carousel" class="splide" aria-label="Beautiful Gallery" data-animation-type="{{ section.settings.animation_type | default: 'fade' }}">
            <div class="splide__track">
              <ul class="splide__list">
                {% for image in product.images %}
                  <li class="splide__slide">
                    {% assign alt_text = image.alt | default: product.title %}
                    {{ image | image_url: width: 800, height: 800 | image_tag: alt: alt_text, loading: 'lazy' }}
                  </li>
                {% endfor %}
              </ul>
            </div>
          </section>

          <!-- Thumbnail Carousel - Following Splide Tutorial -->
          {% if product.images.size > 1 and section.settings.show_thumbnails %}
            <section id="thumbnail-carousel" class="splide" aria-label="The carousel with thumbnails. Selecting a thumbnail will change the Beautiful Gallery carousel.">
              <div class="splide__track">
                <ul class="splide__list">
                  {% for image in product.images %}
                    <li class="splide__slide">
                      {% assign alt_text = image.alt | default: product.title %}
                      {{ image | image_url: width: 160, height: 160 | image_tag: alt: alt_text, loading: 'lazy' }}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </section>
          {% endif %}
        {% else %}
          <!-- Placeholder if no images -->
          <div class="product-hero__main-gallery">
            <div class="product-hero__main-image">
              {{ 'product-1' | placeholder_svg_tag: 'product-placeholder' }}
            </div>
          </div>
        {% endif %}
      </div>

    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "gallery_position",
      "label": "Gallery position",
      "options": [
        {
          "value": "right",
          "label": "Right side (default)"
        },
        {
          "value": "left",
          "label": "Left side"
        }
      ],
      "default": "right"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating",
      "default": true
    },
    {
      "type": "text",
      "id": "rating_value",
      "label": "Rating value",
      "default": "4.7"
    },
    {
      "type": "text",
      "id": "reviews_text",
      "label": "Reviews text",
      "default": "1000+ Verified Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_features",
      "label": "Show product features",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_1",
      "label": "Feature 1",
      "default": "Prevents risk from microplastics"
    },
    {
      "type": "text",
      "id": "feature_2",
      "label": "Feature 2",
      "default": "Resists bacteria and odors"
    },
    {
      "type": "text",
      "id": "feature_3",
      "label": "Feature 3",
      "default": "Keeps your knives sharp"
    },
    {
      "type": "text",
      "id": "feature_4",
      "label": "Feature 4",
      "default": "Eliminates food cross-contamination"
    },
    {
      "type": "checkbox",
      "id": "show_customer_satisfaction",
      "label": "Show customer satisfaction",
      "default": true
    },
    {
      "type": "text",
      "id": "customers_text",
      "label": "Customers text",
      "default": "8K+ Happy Customers"
    },
    {
      "type": "text",
      "id": "stock_text",
      "label": "Stock text",
      "default": "In stock and ready to ship"
    },
    {
      "type": "header",
      "content": "Customer Avatars"
    },
    {
      "type": "checkbox",
      "id": "show_avatars",
      "label": "Show customer avatars",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "avatar_1",
      "label": "Customer avatar 1"
    },
    {
      "type": "image_picker",
      "id": "avatar_2",
      "label": "Customer avatar 2"
    },
    {
      "type": "image_picker",
      "id": "avatar_3",
      "label": "Customer avatar 3"
    },
    {
      "type": "image_picker",
      "id": "avatar_4",
      "label": "Customer avatar 4"
    },
    {
      "type": "checkbox",
      "id": "show_thumbnails",
      "label": "Show thumbnail gallery",
      "default": true
    },
    {
      "type": "header",
      "content": "Animation"
    },
    {
      "type": "select",
      "id": "animation_type",
      "label": "Animation type",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        }
      ],
      "default": "fade"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "header",
      "content": "Product Form"
    },
    {
      "type": "checkbox",
      "id": "show_product_form",
      "label": "Show product form",
      "default": true,
      "info": "Controls the entire product form visibility"
    },
    {
      "type": "checkbox",
      "id": "show_quantity",
      "label": "Show quantity input",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_add_to_cart",
      "label": "Show add to cart button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_payment_buttons",
      "label": "Show payment buttons",
      "default": true,
      "info": "Shows Buy now buttons (Apple Pay, Google Pay, etc.)"
    },
    {
      "type": "header",
      "content": "Guarantees"
    },
    {
      "type": "checkbox",
      "id": "show_guarantees",
      "label": "Show guarantees",
      "default": true
    },
    {
      "type": "text",
      "id": "guarantee_icon_1",
      "label": "Guarantee 1 icon",
      "default": "🔶"
    },
    {
      "type": "text",
      "id": "guarantee_text_1",
      "label": "Guarantee 1 text",
      "default": "PURE TITANIUM"
    },
    {
      "type": "text",
      "id": "guarantee_icon_2",
      "label": "Guarantee 2 icon",
      "default": "⏳"
    },
    {
      "type": "text",
      "id": "guarantee_text_2",
      "label": "Guarantee 2 text",
      "default": "LIFETIME DURABILITY"
    },
    {
      "type": "text",
      "id": "guarantee_icon_3",
      "label": "Guarantee 3 icon",
      "default": "💰"
    },
    {
      "type": "text",
      "id": "guarantee_text_3",
      "label": "Guarantee 3 text",
      "default": "30-DAY MONEY-BACK GUARANTEE"
    },
    {
      "type": "text",
      "id": "guarantee_icon_4",
      "label": "Guarantee 4 icon",
      "default": "🦠"
    },
    {
      "type": "text",
      "id": "guarantee_text_4",
      "label": "Guarantee 4 text",
      "default": "ANTIBACTERIAL AND BPA-FREE"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top",
      "min": 0,
      "max": 6,
      "step": 0.5,
      "unit": "rem",
      "default": 2
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom",
      "min": 0,
      "max": 6,
      "step": 0.5,
      "unit": "rem",
      "default": 2
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}

{% stylesheet %}
/* Copy product-hero layout structure */
.product-hero__content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-xl);
  align-items: start;
  min-height: 600px;
  width: 100%;
  box-sizing: border-box;
  grid-template-areas: "info gallery";
}

/* Default layout: info left, gallery right */
.product-hero__info {
  grid-area: info;
}

.product-hero__gallery {
  grid-area: gallery;
  align-self: start;
}

/* Gallery left layout: gallery left, info right */
.product-hero__content--gallery-left {
  grid-template-areas: "gallery info";
}

.product-hero__content--gallery-left .product-hero__info {
  grid-area: info;
}

.product-hero__content--gallery-left .product-hero__gallery {
  grid-area: gallery;
  align-self: start;
}

/* Mobile responsive layout */
@media screen and (max-width: 768px) {
  .product-hero__content {
    grid-template-columns: 1fr;
    grid-template-areas: "gallery" "info";
    gap: var(--spacing-lg);
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .product-hero__gallery {
    grid-area: gallery;
    grid-column: unset;
  }

  .product-hero__info {
    grid-area: info;
    grid-column: unset;
  }
}

/* Gallery styles */
.product-hero__gallery {
  background: var(--color-bg-primary);
  position: relative;
  width: 100%;
  display: flex;
  flex-direction: column;
  min-height: 400px;
  gap: var(--spacing-md);
}



/* Debug: Make sure gallery is visible */
#main-carousel {
  width: 100%;
  min-height: 300px;
  background: #f9f9f9; /* Temporary debug background */
}

/* Ensure placeholder is visible */
.product-hero__main-gallery {
  width: 100%;
  min-height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f0f0f0;
  border: 2px dashed #ccc;
}

/* Splide Tutorial CSS - Proper Thumbnail Styling */
.splide__slide {
  opacity: 0.6;
  transition: opacity 0.3s ease;
}

.splide__slide.is-active {
  opacity: 1;
}

/* Main carousel images */
#main-carousel .splide__slide img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Thumbnail carousel images - following Splide tutorial exactly */
#thumbnail-carousel .splide__slide img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
}

/* Ensure thumbnail slides have proper dimensions and centering */
#thumbnail-carousel .splide__slide {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f5f5f5;
  overflow: hidden;
  width: 5rem;
  height: 5rem;
  flex-shrink: 0;
  border-radius: var(--radius-sm);
}

#thumbnail-carousel .splide__slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

@media screen and (max-width: 768px) {
  #thumbnail-carousel .splide__slide {
    width: 4.5rem;
    height: 4.5rem;
  }
}

@media screen and (max-width: 600px) {
  #thumbnail-carousel .splide__slide {
    width: 4rem;
    height: 4rem;
  }
}



.product-hero__image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--hero-border);
  color: var(--hero-text-secondary);
  font-size: 18px;
}

/* Customer Satisfaction and Avatars */
.product-hero__satisfaction {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin: var(--spacing-md) 0;
  flex-wrap: wrap;
}

.product-hero__avatars {
  display: flex;
  margin-right: var(--spacing-sm);
}

.product-hero__avatar {
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  border: 2px solid var(--color-bg-primary, #ffffff);
  margin-left: -0.5rem;
  object-fit: cover;
}

.product-hero__avatar:first-child {
  margin-left: 0;
}

.product-hero__customers {
  font-size: 0.875rem;
  font-weight: var(--font-weight-medium);
  color: var(--text-color);
}

.product-hero__stock-indicator {
  color: var(--accent-color, #059669);
  font-size: 1rem;
}

.product-hero__stock {
  font-size: 0.875rem;
  color: var(--accent-color, #059669);
  font-weight: var(--font-weight-medium);
}
{% endstylesheet %}

{{ 'splide.min.css' | asset_url | stylesheet_tag }}
<script src="{{ 'splide.min.js' | asset_url }}" defer></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize Splide gallery exactly like product-hero.liquid
  // Get animation type from data attribute
  var animationType = document.querySelector('#main-carousel').dataset.animationType || 'fade';
  
  var main = new Splide('#main-carousel', {
    type      : animationType,
    rewind    : true,
    pagination: false,
    arrows    : {{ section.settings.show_navigation | json }},
    speed     : 400,
    easing    : 'cubic-bezier(0.25, 1, 0.5, 1)',
  });

  {% if product.images.size > 1 and section.settings.show_thumbnails %}
  var thumbnails = new Splide('#thumbnail-carousel', {
    gap         : 20,
    rewind      : false,
    pagination  : false,
    arrows      : false,
    isNavigation: true,
    focus       : 0,
    perPage     : 5,
    perMove     : 5,
    trimSpace   : false,
    width       : '100%',
    height      : '100%',
    snap        : true,
    breakpoints : {
      768: {
        perPage    : 4,
        perMove    : 4,
        gap        : 15,
      },
      600: {
        perPage    : 3,
        perMove    : 3,
        gap        : 10,
      },
    },
  });

  main.sync(thumbnails);
  thumbnails.mount();
  {% endif %}
  
  main.mount();

  // Handle variant change for price updates
  const variantSelect = document.querySelector('#variant-select');
  const priceDisplay = document.querySelector('.product-hero__price');
  const addToCartButton = document.querySelector('.product-hero__cta');
  
  if (variantSelect && priceDisplay && addToCartButton) {
    variantSelect.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      const price = selectedOption.dataset.price;
      const comparePrice = selectedOption.dataset.comparePrice;
      const available = !selectedOption.disabled;
      
      // Update price display
      if (comparePrice && comparePrice !== 'null' && comparePrice !== price) {
        priceDisplay.innerHTML = `
          <span class="product-hero__price-compare">${comparePrice}</span>
          <span class="product-hero__price-current">${price}</span>
        `;
      } else {
        priceDisplay.innerHTML = `<span class="product-hero__price-current">${price}</span>`;
      }
      
      // Update add to cart button
      if (available) {
        addToCartButton.disabled = false;
        addToCartButton.textContent = '{{ "products.add_to_cart" | t | default: "Add to cart" }}';
      } else {
        addToCartButton.disabled = true;
        addToCartButton.textContent = '{{ "products.sold_out" | t | default: "Sold out" }}';
      }
    });
  }
});
</script>
