{% comment %}
  Cutting Board Comparison Section
  A full-width section showing the drawbacks of different cutting board materials
  with customizable blocks for images, icons, titles, and descriptions
{% endcomment %}

{% render 'theme-styles-variables' %}

<div class="cutting-board-comparison">
  <div class="cutting-board-comparison__container">
    {% if section.settings.headline != blank %}
      <div class="cutting-board-comparison__header">
        <h2 class="cutting-board-comparison__headline">{{ section.settings.headline }}</h2>
        {% if section.settings.subheadline != blank %}
          <p class="cutting-board-comparison__subheadline">{{ section.settings.subheadline }}</p>
        {% endif %}
        <div class="cutting-board-comparison__separator"></div>
      </div>
    {% endif %}

    <div class="cutting-board-comparison__content">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'material_block' %}
            <div class="cutting-board-comparison__block" {{ block.shopify_attributes }}>
              {% if block.settings.image != blank %}
                <div class="cutting-board-comparison__image-wrapper">
                  {{ block.settings.image | image_url: width: 500, height: 500 | image_tag: 
                     alt: block.settings.image.alt, 
                     class: 'cutting-board-comparison__image' }}
                </div>
              {% endif %}
              
              {% if block.settings.title != blank %}
                <div class="cutting-board-comparison__title-wrapper">
                  {% if block.settings.icon_name != blank %}
                    <div class="cutting-board-comparison__icon" style="
                      --icon-size: {{ block.settings.icon_size | default: 1.5 }}rem;
                      --icon-color: {{ block.settings.icon_color | default: '#666666' }};
                      --icon-opacity: {{ block.settings.icon_opacity | default: 100 | divided_by: 100.0 }};
                    ">
                      {% assign icon_filename = block.settings.icon_name | append: '.svg' %}
                      <div class="cutting-board-comparison__icon-svg" 
                           style="width: {{ block.settings.icon_size | default: 1.5 }}rem; height: {{ block.settings.icon_size | default: 1.5 }}rem;"
                           data-icon="{{ icon_filename | asset_url }}"
                           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                      </div>
                      <div class="cutting-board-comparison__icon-fallback" style="display: none; width: 100%; height: 100%; background: var(--icon-color, #666666); border-radius: 50%; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">
                        {{ block.settings.icon_name | slice: 0, 2 | upcase }}
                      </div>
                    </div>
                  {% endif %}
                  <h3 class="cutting-board-comparison__title">{{ block.settings.title }}</h3>
                </div>
              {% endif %}
              
              {% if block.settings.description != blank %}
                <p class="cutting-board-comparison__description">{{ block.settings.description }}</p>
              {% endif %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% stylesheet %}
.cutting-board-comparison {
  width: 100%;
  background: var(--color-bg-primary);
  padding: var(--section-padding-y) 0;
}

.cutting-board-comparison__container {
  max-width: var(--container-max-width);
  margin: 0 auto;
  padding: 0 var(--container-padding);
}

.cutting-board-comparison__header {
  text-align: center;
  margin-bottom: var(--spacing-3xl);
}

.cutting-board-comparison__headline {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
  margin: 0 0 var(--spacing-lg) 0;
  line-height: var(--line-height-tight);
}

.cutting-board-comparison__subheadline {
  font-size: var(--font-size-lg);
  color: var(--color-text-secondary);
  margin: 0 0 var(--spacing-xl) 0;
  line-height: var(--line-height-normal);
  max-width: 60rem;
  margin-left: auto;
  margin-right: auto;
}

.cutting-board-comparison__separator {
  width: 4rem;
  height: 0.125rem;
  background: var(--color-border-dark);
  margin: 0 auto;
}

.cutting-board-comparison__content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
  gap: var(--spacing-2xl);
  align-items: start;
}

.cutting-board-comparison__block {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: var(--spacing-lg);
}

.cutting-board-comparison__image-wrapper {
  width: 100%;
  max-width: 18rem;
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-md);
}

.cutting-board-comparison__image {
  width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
  object-position: center;
  aspect-ratio: 1 / 1;
  transition: transform var(--transition-normal);
}

.cutting-board-comparison__image:hover {
  transform: scale(1.05);
}

.cutting-board-comparison__title-wrapper {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
}

.cutting-board-comparison__icon {
  width: var(--icon-size, 1.5rem);
  height: var(--icon-size, 1.5rem);
  color: var(--icon-color, var(--color-text-secondary));
  opacity: var(--icon-opacity, 1);
  flex-shrink: 0;
}

.cutting-board-comparison__icon-svg {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cutting-board-comparison__icon-svg svg {
  width: 100%;
  height: 100%;
}

.cutting-board-comparison__title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0;
  line-height: var(--line-height-tight);
}

.cutting-board-comparison__description {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  line-height: var(--line-height-normal);
  margin: 0;
  max-width: 20rem;
}

@media screen and (max-width: 48rem) {
  .cutting-board-comparison__content {
    grid-template-columns: 1fr;
    gap: var(--spacing-xl);
  }
  
  .cutting-board-comparison__headline {
    font-size: var(--font-size-2xl);
  }
  
  .cutting-board-comparison__subheadline {
    font-size: var(--font-size-base);
  }
  
  .cutting-board-comparison__block {
    gap: var(--spacing-md);
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Cutting Board Comparison",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Headline",
      "default": "Most Boards are Damaging Your Health & Knives"
    },
    {
      "type": "textarea",
      "id": "subheadline",
      "label": "Subheadline",
      "default": "A cutting board might seem like a simple tool, but the wrong material can silently threaten the safety of your food and destroy your knives over time."
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 6,
      "step": 0.5,
      "unit": "rem",
      "label": "Padding top",
      "default": 2
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 6,
      "step": 0.5,
      "unit": "rem",
      "label": "Padding bottom",
      "default": 2
    }
  ],
  "blocks": [
    {
      "type": "material_block",
      "name": "Material Block",
      "limit": 4,
      "settings": [
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "icon_name",
          "label": "Icon name",
          "info": "Type any Feather icon name (e.g., 'activity', 'heart', 'star', 'zap', 'shield'). Browse all available icons at feathericons.com",
          "default": "activity"
        },
        {
          "type": "header",
          "content": "Icon Styling"
        },
        {
          "type": "range",
          "id": "icon_size",
          "min": 1,
          "max": 3,
          "step": 0.5,
          "unit": "rem",
          "label": "Icon size",
          "default": 1.5
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon color",
          "default": "#666666"
        },
        {
          "type": "range",
          "id": "icon_opacity",
          "min": 0,
          "max": 100,
          "step": 10,
          "unit": "%",
          "label": "Icon opacity",
          "default": 100
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Wood/Bamboo"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Natural materials can let bacteria and mold grow, in grooves and cuts, even if invisible, which can contaminate your food over time resulting in you feeling ill. They also absorb odors & stain easily."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Cutting Board Comparison",
      "blocks": [
        {
          "type": "material_block",
          "settings": {
            "title": "Wood/Bamboo",
            "description": "Natural materials can let bacteria and mold grow, in grooves and cuts, even if invisible, which can contaminate your food over time resulting in you feeling ill. They also absorb odors & stain easily."
          }
        },
        {
          "type": "material_block",
          "settings": {
            "title": "Plastic/Epicurean",
            "description": "Many plastic boards contain BPAs, phthalates, or other toxic chemicals that can leach into food as you cut. Plus, plastic scratches easily, creating tiny crevices where bacteria can accumulate and thrive."
          }
        },
        {
          "type": "material_block",
          "settings": {
            "title": "Glass/Stone/Steel",
            "description": "While these materials may seem hygienic, their extreme hardness wrecks your knives. Every cut rapidly dulls your blades, forcing you to sharpen or replace them far more often - wasting time, effort, and money."
          }
        }
      ]
    }
  ]
}
{% endschema %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Load SVG icons and apply color styling
  const iconContainers = document.querySelectorAll('.cutting-board-comparison__icon-svg');
  
  iconContainers.forEach(container => {
    const iconUrl = container.dataset.icon;
    const iconName = container.dataset.icon.split('/').pop().replace('.svg', '');
    
    fetch(iconUrl)
      .then(response => response.text())
      .then(svgContent => {
        // Replace the container with the SVG content
        container.innerHTML = svgContent;
        
        // Apply color styling to the SVG
        const svg = container.querySelector('svg');
        if (svg) {
          // Get the computed color from CSS variables
          const computedStyle = getComputedStyle(container.parentElement);
          const iconColor = computedStyle.getPropertyValue('--icon-color') || '#666666';
          const iconOpacity = computedStyle.getPropertyValue('--icon-opacity') || '1';
          
          // Apply color and opacity to the SVG
          svg.style.color = iconColor;
          svg.style.opacity = iconOpacity;
          
          // Also apply to stroke and fill if they exist
          const paths = svg.querySelectorAll('path, polyline, line, rect, circle, polygon');
          paths.forEach(path => {
            if (path.getAttribute('stroke') === 'currentColor') {
              path.setAttribute('stroke', iconColor);
            }
            if (path.getAttribute('fill') === 'currentColor') {
              path.setAttribute('fill', iconColor);
            }
          });
        }
      })
      .catch(error => {
        console.error('Failed to load icon:', iconName, error);
        // Show fallback on error
        container.style.display = 'none';
        const fallback = container.nextElementSibling;
        if (fallback) {
          fallback.style.display = 'flex';
        }
      });
  });
});
</script>
